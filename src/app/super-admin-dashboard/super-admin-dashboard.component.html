<div class="dashboard-wrapper">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <h2>Super Admin</h2>
    <nav>
      <button (click)="navigateToProduits()">ğŸ“¦ Produits</button>
      <button (click)="navigateToUsers()">ğŸ‘¥ Utilisateurs</button>
      <button (click)="navigateToAddProduct()">â• Ajouter un Produit</button>
      <button class="logout-btn" (click)="logout()">ğŸšª DÃ©connexion</button>
    </nav>
  </aside>

  <!-- CONTENU -->
  <main class="main-content">
    <h1>Bienvenue sur votre tableau de bord</h1>

    <!-- Utilisateurs par rÃ´le -->
    <section class="stats-section">
      <h3>ğŸ“Š RÃ©partition des rÃ´les utilisateurs</h3>
      <ngx-charts-pie-chart
        [view]="[500, 400]"
        [scheme]="colorScheme"
        [results]="userRoleCounts"
        [legend]="true"
        [labels]="true"
        [doughnut]="true">
      </ngx-charts-pie-chart>
    </section>

    <!-- Produits par stock -->
    <section class="stats-section">
      <h3>ğŸ“¦ Stock par produit</h3>
      <ngx-charts-bar-vertical
        [view]="[600, 400]"
        [scheme]="colorScheme"
        [results]="productQuantities"
        [xAxis]="true"
        [yAxis]="true"
        [legend]="false"
        [showXAxisLabel]="true"
        [showYAxisLabel]="true"
        [xAxisLabel]="'Produit'"
        [yAxisLabel]="'Stock'">
      </ngx-charts-bar-vertical>
    </section>

    <!-- Commandes par statut -->
    <section class="stats-section">
      <h3>ğŸ“‘ Commandes par statut</h3>
      <ngx-charts-pie-chart
        [view]="[500, 400]"
        [scheme]="colorScheme"
        [results]="commandeStatusCounts"
        [legend]="true"
        [labels]="true"
        [doughnut]="true">
      </ngx-charts-pie-chart>
    </section>

    <!-- Liste des commandes avec coordonnÃ©es utilisateur -->
    <!-- Section Liste des commandes -->
<section class="stats-section">
  <h3>ğŸ“‘ Liste des commandes</h3>
  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Utilisateur</th>
        <th>TÃ©lÃ©phone</th>
        <th>Adresse</th>
        <th>Date</th>
        <th>Statut</th>
        <th>Total</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let cmd of commandes">
        <td>{{ cmd.id }}</td>
        <td>{{ cmd.username }}</td>
        <td>{{ cmd.numeroTelephone }}</td>
        <td>{{ cmd.adresseLivraison }}</td>
        <td>{{ cmd.dateCreation | date:'short' }}</td>
        <td>
          <span 
            class="status-badge" 
            [ngClass]="{
            'pending': cmd.statut === 'EnAttente',
            'processing': cmd.statut === 'EnCours',
            'delivered': cmd.statut === 'Livree',
            'cancelled': cmd.statut === 'Annulee',
            'expired': cmd.statut === 'ExpÃ©diÃ©e',
            'finished': cmd.statut === 'Terminee'
         }">
          {{ cmd.statut }}
        </span>

        </td>
        <td>{{ cmd.total | currency:'TND' }}</td>
        <td>
          <button (click)="changerStatut(cmd.id, 'EnCours')">ğŸšš En cours</button>
          <button (click)="changerStatut(cmd.id, 'Livree')">âœ… LivrÃ©e</button>
          <button (click)="annulerCommande(cmd.id)" class="cancel-btn">âŒ Annuler</button>
          <button (click)="changerStatut(cmd.id,'ExpÃ©diÃ©e')" class="ship-btn">ğŸ“¦ ExpÃ©diÃ©e</button>
          <button (click)="changerStatut(cmd.id,'Terminee')" class="finish-btn">ğŸ TerminÃ©e</button>
          <button (click)="voirDetails(cmd)" class="details-btn">ğŸ‘ï¸ Voir dÃ©tails</button>
        </td>
      </tr>
    </tbody>
  </table>
</section>

<!-- Modal / Vitrine commande -->
<div class="modal-overlay" *ngIf="selectedCommande">
  <div class="modal-card">
    <button class="modal-close" (click)="selectedCommande = undefined">âœ–</button>
    <h3>Commande #{{ selectedCommande.id }}</h3>
    <p><strong>Client :</strong> {{ selectedCommande.username }}</p>
    <p><strong>TÃ©lÃ©phone :</strong> {{ selectedCommande.numeroTelephone }}</p>
    <p><strong>Adresse :</strong> {{ selectedCommande.adresseLivraison }}</p>
    <p><strong>Statut :</strong> {{ selectedCommande.statut }}</p>
    
    <h4>Produits :</h4>
    <div class="commande-items">
      <div *ngFor="let item of selectedCommande.items" class="commande-item-card">
        <img [src]="'https://localhost:7241' + item.imageUrl" alt="{{ item.produitNom }}">
        <div class="item-info">
          <p><strong>{{ item.produitNom }}</strong></p>
          <p>Prix unitaire : {{ item.prixUnitaire | currency:'TND' }}</p>
          <p>QuantitÃ© : {{ item.quantite }}</p>
          <p>Sous-total : {{ item.sousTotal | currency:'TND' }}</p>
        </div>
      </div>
    </div>

    <h4>Total : {{ selectedCommande.total | currency:'TND' }}</h4>
  </div>
</div>


  </main>
</div>
